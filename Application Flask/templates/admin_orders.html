<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Orders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        pre {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_orders.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar Navigation -->
<!-- Sidebar Navigation -->
<aside class="sidebar">
    <div class="sidebar-header">
        <h2>Admin Panel</h2>
        <button class="toggle-sidebar">
            <i class="fas fa-bars"></i>
        </button>
    </div>
    <ul class="sidebar-menu">
        <li >
            <a href="{{ url_for('home_admin') }}">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
        </li>

        <li >
            <a href="{{ url_for('gestion_produits') }}">
                <i class="fas fa-box-open"></i>
                <span>Products</span>
            </a>
        </li>
        
        <li class="active">
            <a href="{{ url_for('admin_orders') }}" >
                <i class="fas fa-shopping-cart"></i>
                <span>Orders</span>
            </a>
        </li>

        <li class="has-submenu">
            <a href="#" class="submenu-toggle">
                <i class="fas fa-gavel"></i>
                <span>Auctions</span>
                <i class="fas fa-chevron-down dropdown-icon"></i>
            </a>
            <ul class="submenu">
                <li>
                    <a href="{{ url_for('gestion_encheres') }}">Auctions Products</a>
                </li>
                <li>
                    <a href="{{ url_for('historique_encheres') }}">Auction History</a>
                </li>
                <li>
                  <a href="{{ url_for('auction_winners') }}">Auction Winners</a>
              </li>                    
            </ul>
        </li>



        <li>
            <a href="{{ url_for('admin_messages') }}">
                <i class="fas fa-envelope"></i>
                <span>Messages</span>
                <span class="badge">{{ message_count }}</span>
            </a>
        </li>

        <li>
            <a href="#">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </li>
    </ul>
    <div class="sidebar-footer">
        <div class="user-profile">
            <img src="{{ url_for('static', filename='img/admin-avatar.jpg') }}" alt="Admin" />
            <div class="user-info">
                <h4>{{ current_user.FirstName }} {{ current_user.LastName }}</h4>
                <small>Admin</small>
            </div>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </a>
    </div>
</aside>
<div class="main-content-area">
    <div class="content-wrapper">
        
        <div class="content-wrapper">
            <header class="main-header">
                <div class="header-title">
                    <h1>Orders</h1>
                    <div class="order-summary">
                        <span class="summary-item"><strong>{{ total_orders }}</strong> total orders</span>
                        <span class="summary-item"><strong>{{ pending_orders }}</strong> pending</span>
                        <span class="summary-item"><strong>{{ today_orders }}</strong> today</span>
                    </div>
                </div>
                
            </header>
            
            <main class="main-content">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <div class="orders-container">

                    
                    <div class="table-responsive">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th width="40px"><input type="checkbox"></th>
                                    <th width="80px">Order</th>
                                    <th width="120px">Customer</th>
                                    <th width="100px">Date</th>
                                    <th width="100px">Amount</th>
                                    <th width="100px">Status</th>
                                    <th width="150px">Items</th>
                                    <th width="120px">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order_id, order in orders.items() %}
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>#{{ order_id }}</td>
                                    <td>
                                        <div class="customer-cell">
                                            <div class="customer-name">{{ order.FirstName }} {{ order.LastName }}</div>
                                            <div class="customer-email">{{ order.Email }}</div>
                                        </div>
                                    </td>
                                    <td>{{ order.order_date }}</td>
                                    <td>${{ order.total_amount }}</td>
                                    <td>
                                        <span class="status-badge status-{{ order.status }}">
                                            {{ order.status|capitalize }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="order-items-collapsed">
                                            {{ order.order_items|length }} items
                                            <div class="items-tooltip">
                                                {% for item in order.order_items %}
                                                <div class="tooltip-item">
                                                    {{ item.product_name }} (x{{ item.quantity }})
                                                    <span>${{ item.price_per_unit }}</span>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn quick-edit" title="Quick Edit">
                                                <i class="fas fa-pencil-alt"></i>
                                            </button>
                                            <form class="status-form" action="{{ url_for('update_order_status', order_id=order_id) }}" method="POST">
                                                <select name="status" class="status-select">
                                                    <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                                                    <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
                                                    <option value="canceled" {% if order.status == 'canceled' %}selected{% endif %}>Canceled</option>
                                                </select>

                                                
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-footer">
                        <div class="table-pagination">
                            <button class="btn pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="page-info">1-{{ orders|length }} of {{ orders|length }}</span>
                            <button class="btn pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>
</div>
    <script>
        // Toggle sidebar
        document.querySelector('.toggle-sidebar').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
            document.querySelector('.content-wrapper').classList.toggle('expanded');
        });
        
        // Show items tooltip
        document.querySelectorAll('.order-items-collapsed').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                document.querySelectorAll('.items-tooltip').forEach(tooltip => {
                    tooltip.style.display = 'none';
                });
                this.querySelector('.items-tooltip').style.display = 'block';
            });
        });
        
        // Hide tooltips when clicking elsewhere
        document.addEventListener('click', function() {
            document.querySelectorAll('.items-tooltip').forEach(tooltip => {
                tooltip.style.display = 'none';
            });
        });
        
        // Submit status form on change
        document.querySelectorAll('.status-select').forEach(select => {
            select.addEventListener('change', function() {
                this.closest('form').submit();
            });
        });


                // Toggle submenus
                document.querySelectorAll(".submenu-toggle").forEach((item) => {
                    item.addEventListener("click", function (e) {
                        e.preventDefault();
                        const parent = this.parentElement;
                        parent.classList.toggle("active");
        
                        // Rotate the dropdown icon
                        const icon = this.querySelector(".dropdown-icon");
                        if (parent.classList.contains("active")) {
                            icon.classList.remove("fa-chevron-down");
                            icon.classList.add("fa-chevron-up");
                        } else {
                            icon.classList.remove("fa-chevron-up");
                            icon.classList.add("fa-chevron-down");
                        }
                    });
                });
        
                // Toggle sidebar (for mobile)
                document.querySelector(".toggle-sidebar").addEventListener("click", function () {
                    document.querySelector(".sidebar").classList.toggle("collapsed");
                });
                
    </script>

    <!-- Update the search box in the header -->



</body>
</html>