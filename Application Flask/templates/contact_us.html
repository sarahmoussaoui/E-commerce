<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" />
        </div>
        <ul class="nav-links">
            <li><a href="">Accueil</a></li>
            <li><a href="">Produits</a></li>
            <li><a href="{{ url_for('about_us') }}">Ã€ propos</a></li>
            <li><a href="">Contact</a></li>
        </ul>
    </nav>

    <!-- Contact Us Section -->
    <section class="contact-section">
        <div class="contact-container">
            <h1>Contact Us</h1>
            <p>We'd love to hear from you! Reach out to us for any inquiries or feedback.</p>
            <form id="contact-form" action="{{ url_for('contact') }}" method="POST">
                <label for="email">Objet</label>
                <input type="text" id="email" name="email" placeholder="Your email" required>
            
                <label for="message">Message</label>
                <textarea id="message" name="message" placeholder="Your message" rows="5" required></textarea>
            
                <button type="submit">Send Message</button>
            </form>
        </div>
    </section>
<!-- Add this button below your contact form -->
<button id="show-messages-btn">Show My Messages</button>

<!-- Container to display the list of message objects -->
<div id="messages-container" style="margin-top: 20px;"></div>



    <!-- Back to Home Link -->
    <div class="back-link-container">
        <a href="index.html" class="back-link">Back to Home</a>
    </div>

<!-- Success Message -->
<div id="success-message" class="success-message">
    <button class="close-btn" onclick="closeSuccessMessage()">&times;</button>
    <p>Thank you! We will treat your message in the nearest time.</p>
</div>

    <!-- JavaScript to handle form submission -->
    <script>
// Function to close the success message
function closeSuccessMessage() {
    const successMessage = document.getElementById("success-message");
    successMessage.style.display = "none";
}

// Modify the form submission handler to show the success message
document.getElementById("contact-form").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent the default form submission

    // Submit the form using Fetch API
    fetch("{{ url_for('contact') }}", {
        method: "POST",
        body: new FormData(this),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show the success message
            const successMessage = document.getElementById("success-message");
            successMessage.style.display = "block";

            // Hide the message after 5 seconds (optional)
            setTimeout(() => {
                successMessage.style.display = "none";
            }, 5000);

            // Optionally, reset the form
            document.getElementById("contact-form").reset();
        }
    })
    .catch(error => {
        console.error("Error:", error);
    });
});
    // Function to fetch and display messages
    function fetchAndDisplayMessages() {
        fetch("{{ url_for('get_messages') }}")
            .then(response => response.json())
            .then(messages => {
                const messagesContainer = document.getElementById("messages-container");
                messagesContainer.innerHTML = ""; // Clear previous content

                if (messages.length === 0) {
                    messagesContainer.innerHTML = "<p>No messages found.</p>";
                    return;
                }

                // Create a list of message objects
                messages.forEach(msg => {
                    const messageDiv = document.createElement("div");
                    messageDiv.className = "message-item";
                    messageDiv.innerHTML = `
                        <strong>${msg.objet}</strong>
                        <div class="message-date">${msg.date}</div>
                        <div class="message-text" style="display: none;">${msg.message}</div>
                    `;

                    // Add click event to show/hide the full message text
                    messageDiv.addEventListener("click", () => {
                        const messageText = messageDiv.querySelector(".message-text");
                        messageText.style.display = messageText.style.display === "none" ? "block" : "none";
                    });

                    messagesContainer.appendChild(messageDiv);
                });
            })
            .catch(error => {
                console.error("Error fetching messages:", error);
            });
    }

    // Add event listener to the button
    document.getElementById("show-messages-btn").addEventListener("click", fetchAndDisplayMessages);
</script>
</body>
</html>