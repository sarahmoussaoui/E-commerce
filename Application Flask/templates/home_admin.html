<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='home_admin.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="admin-container">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>Admin Panel</h2>
          <button class="toggle-sidebar">
            <i class="fas fa-bars"></i>
          </button>
        </div>
        <ul class="sidebar-menu">
          <li class="active">
            <a href="{{ url_for('home_admin') }}">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>

          <li class="has-submenu">
            <a href="#" class="submenu-toggle">
              <i class="fas fa-box-open"></i>
              <span>Products</span>
              <i class="fas fa-chevron-down dropdown-icon"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="{{ url_for('gestion_produits') }}">All Products</a>
              </li>
              <li><a href="#">Add New Product</a></li>
              <li><a href="#">Categories</a></li>
              <li><a href="#">Inventory</a></li>
            </ul>
          </li>

          <li class="has-submenu">
            <a href="#" class="submenu-toggle">
              <i class="fas fa-gavel"></i>
              <span>Auctions</span>
              <i class="fas fa-chevron-down dropdown-icon"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="{{ url_for('gestion_encheres') }}">Active Auctions</a>
              </li>
              <li><a href="#">Schedule Auction</a></li>
              <li>
                <a href="{{ url_for('historique_encheres') }}">Auction History</a>
              </li>
              <li><a href="#">Bid Management</a></li>
            </ul>
          </li>

          <li class="has-submenu">
            <a href="#" class="submenu-toggle">
              <i class="fas fa-shopping-cart"></i>
              <span>Orders</span>
              <i class="fas fa-chevron-down dropdown-icon"></i>
            </a>
            <ul class="submenu">
              <li><a href="{{ url_for('admin_orders') }}">All Orders</a></li>
              <li><a href="#">Pending Orders</a></li>
              <li><a href="#">Completed Orders</a></li>
              <li><a href="#">Shipping</a></li>
            </ul>
          </li>

          <li>
            <a href="{{ url_for('admin_messages') }}">
              <i class="fas fa-envelope"></i>
              <span>Messages</span>
              <span class="badge">{{ message_count }}</span>
            </a>
          </li>

          <li>
            <a href="#">
              <i class="fas fa-users"></i>
              <span>Users</span>
            </a>
          </li>

          <li>
            <a href="#">
              <i class="fas fa-chart-line"></i>
              <span>Reports</span>
            </a>
          </li>

          <li>
            <a href="#">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </a>
          </li>
        </ul>
        <div class="sidebar-footer">
          <div class="user-profile">
            <img
              src="{{ url_for('static', filename='img/admin-avatar.jpg') }}"
              alt="Admin"
            />
            <div class="user-info">
              <h4>{{ current_user.FirstName }} {{ current_user.LastName }}</h4>
              <small>Admin</small>
            </div>
          </div>
          <a href="{{ url_for('logout') }}" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="main-content">
        <header class="main-header">
          <h1>Dashboard Overview</h1>
          <div class="header-actions">
            <div class="search-box">
              <input type="text" placeholder="Search..." />
              <button><i class="fas fa-search"></i></button>
            </div>
            <div class="notifications">
              <button class="notification-btn">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
              </button>
            </div>
          </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-icon" style="background-color: #f4acb7;">
              <i class="fas fa-box-open"></i>
            </div>
            <div class="stat-info">
              <h3>Total Products</h3>
              <p>{{ product_count }}</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" style="background-color: #9d8189;">
              <i class="fas fa-gavel"></i>
            </div>
            <div class="stat-info">
              <h3>Active Auctions</h3>
              <p>{{ auction_count }}</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" style="background-color: #ffcad4;">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-info">
              <h3>Pending Orders</h3>
              <p>{{ order_count }}</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" style="background-color: #d8e2dc;">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="stat-info">
              <h3>Unread Messages</h3>
              <p>{{ message_count }}</p>
            </div>
          </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
          <!-- Recent Orders Section -->
          <div class="content-card">
            <div class="card-header">
              <h2>Recent Orders</h2>
              <a href="{{ url_for('admin_orders') }}" class="view-all">View All</a>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for order in recent_orders %}
                  <tr>
                    <td>#{{ order.id }}</td>
                    <td>
                      {% if order.FirstName %}
                        {{ order.FirstName }} {{ order.LastName }}
                      {% else %}
                        Guest
                      {% endif %}
                    </td>
                    <td>{{ order.order_date }}</td>
                    <td>${{ "%.2f"|format(order.total_amount) }}</td>
                    <td>
                      <span class="status {{ order.status }}">
                        {{ order.status|capitalize }}
                      </span>
                    </td>
                    <td>
                      <a
                        href="{{ url_for('order_details', order_id=order.id) }}"
                        class="action-btn"
                        >View</a
                      >
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Active Auctions Section -->
          <div class="content-card">
            <div class="card-header">
              <h2>Active Auctions</h2>
              <a href="{{ url_for('gestion_encheres') }}" class="view-all"
                >View All</a
              >
            </div>
            <div class="auctions-grid">
              {% for auction in active_auctions %}
              <div class="auction-item">
                <div class="auction-img">
                  <img
                    src="{{ auction.image_url or url_for('static', filename='img/default-auction.jpg') }}"
                    alt="Auction Item"
                  />
                </div>
                <div class="auction-info">
                  <h3>{{ auction.name }}</h3>
                  <div class="auction-meta">
                    <div class="bid-info">
                      <span class="current-bid">${{ "%.2f"|format(auction.prix) }}</span>
                      <span class="bid-count">{{ auction.bid_count }} bids</span>
                    </div>
                    <div class="time-left">
                      <i class="fas fa-clock"></i>
                      <span>Ends: {{ auction.date_fin }}</span>
                    </div>
                  </div>
                  <div class="progress-bar">
                    <div
                      class="progress"
                      style="width: {{ auction.progress }}%"
                    ></div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Quick Stats Section -->
          <div class="content-card">
            <div class="card-header">
              <h2>Quick Stats</h2>
            </div>
            <div class="stats-chart">
              <!-- This would be replaced with a real chart in implementation -->
              <div class="chart-placeholder">
                <img
                  src="{{ url_for('static', filename='img/chart-placeholder.png') }}"
                  alt="Sales Chart"
                />
              </div>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="color-dot" style="background-color: #f4acb7;"></span>
                  <span>Products</span>
                </div>
                <div class="legend-item">
                  <span class="color-dot" style="background-color: #9d8189;"></span>
                  <span>Auctions</span>
                </div>
                <div class="legend-item">
                  <span class="color-dot" style="background-color: #ffcad4;"></span>
                  <span>Orders</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity Section -->
          <div class="content-card">
            <div class="card-header">
              <h2>Recent Activity</h2>
            </div>
            <div class="activity-list">
              {% for activity in recent_activities %}
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-{{ activity.icon }}"></i>
                </div>
                <div class="activity-content">
                  <p>{{ activity.message|safe }}</p>
                  <small>{{ activity.timestamp }}</small>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Toggle submenus
      document.querySelectorAll(".submenu-toggle").forEach((item) => {
        item.addEventListener("click", function (e) {
          e.preventDefault();
          const parent = this.parentElement;
          parent.classList.toggle("active");

          // Rotate the dropdown icon
          const icon = this.querySelector(".dropdown-icon");
          if (parent.classList.contains("active")) {
            icon.classList.remove("fa-chevron-down");
            icon.classList.add("fa-chevron-up");
          } else {
            icon.classList.remove("fa-chevron-up");
            icon.classList.add("fa-chevron-down");
          }
        });
      });

      // Toggle sidebar (for mobile)
      document
        .querySelector(".toggle-sidebar")
        .addEventListener("click", function () {
          document.querySelector(".sidebar").classList.toggle("collapsed");
        });
    </script>
  </body>
</html>